<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="profile-settings.css" />
  <!-- ШРИФТЫ -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Ubuntu:wght@500;700&display=swap" rel="stylesheet">
  <title>Settings</title>
</head>
<body>
                           <header class="hdr">
  <!-- фоновый прямоугольник -->
  <div class="hdr-bg"></div>

  <!-- LOGO -->
  <a class="logo" href="#">
    <span class="logo-text">Qonte</span>
    <span class="logo-dot" aria-hidden="true"></span>
  </a>

  <!-- SEARCH GROUP -->
  <form class="search-wrap" action="#" role="search">
  <input class="search-input" type="text" placeholder="Пошук..." aria-label="Пошук">
  <button class="search-btn" type="submit" aria-label="Найти">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <circle cx="10" cy="10" r="6.5" fill="none" stroke="#7AD293" stroke-width="1.5"/>
      <rect x="16" y="16" width="6" height="6" rx="1.2" fill="#7AD293"/>
    </svg>
  </button>
</form>

  <!-- КНОПКА AI -->
<button class="btn-ai" type="button">
  <span class="ai-ico" aria-hidden="true">
    <!-- иконка «робот/ИИ» -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#7AD293" stroke-width="2">
      <circle cx="12" cy="12" r="9"/>
      <circle cx="9" cy="10" r="1"/>
      <circle cx="15" cy="10" r="1"/>
      <path d="M8 15c1.5 1 3.5 1 5 0"/>
    </svg>
  </span>
  <span class="ai-label">AI-Консультант</span>
</button>

<!-- КНОПКА КАТАЛОГ -->
<button class="btn-cat" type="button">
  <span class="cat-ico" aria-hidden="true">
    <!-- иконка «меню/каталог» -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#7AD293" stroke-width="2">
      <rect x="3" y="4" width="7" height="7"/>
      <rect x="14" y="4" width="7" height="7"/>
      <rect x="3" y="13" width="7" height="7"/>
      <rect x="14" y="13" width="7" height="7"/>
    </svg>
  </span>
  <span class="cat-label">Каталог</span>
</button>

  <!-- ИКОНКИ 3–6 -->
  <button class="ico ico-lang" type="button" aria-label="Выбор языка">
    <!-- Иконка "язык" -->
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#ECECEC" stroke-width="2" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="10"/>
      <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
    </svg>
  </button>

  <button class="ico ico-heart" type="button" aria-label="Избранное">
    <!-- Иконка "сердце" -->
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#ECECEC" stroke-width="2" viewBox="0 0 24 24">
      <path d="M12 21s-6-4.3-9-8.6C1 9.3 3.5 5 7.5 5c2.1 0 3.5 1.1 4.5 2.5C13 6.1 14.4 5 16.5 5 20.5 5 23 9.3 21 12.4c-3 4.3-9 8.6-9 8.6z"/>
    </svg>
  </button>

  <button class="ico ico-cart" type="button" aria-label="Корзина">
    <!-- Иконка "корзина" -->
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#ECECEC" stroke-width="2" viewBox="0 0 24 24">
      <circle cx="9" cy="21" r="1"/>
      <circle cx="20" cy="21" r="1"/>
      <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
    </svg>
  </button>

  <button class="ico ico-user" type="button" aria-label="Аккаунт">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#7AD293" viewBox="0 0 24 24">
      <circle cx="12" cy="8" r="4"/>
      <path d="M6 20c0-3.3 2.7-6 6-6s6 2.7 6 6"/>
    </svg>
  </button>
</header>





<!-- ===== Поле A (Group 259) 391×55 @ (80,251) ===== -->
<div class="inline-field" data-field="city" data-maxlen="30"
     style="left:80px; top:251px; width:391px; height:55px; position:absolute;">
  <div class="inline-field__frame"></div>
  <span class="inline-field__value">Іван Франковській</span>
  <input class="inline-field__input" type="text" hidden maxlength="30" inputmode="text">
  <!-- Иконка редактирования: 29×29 @ (421,264) ⇒ offset внутри контейнера (341,13) -->
  <button class="inline-field__edit" type="button" aria-label="Редагувати"
          style="left:341px; top:13px;">
    <img src="edit.png" alt="" width="29" height="29" draggable="false">
  </button>
</div>

<!-- ===== Поле B (Group 260) 391×55 @ (80,316) ===== -->
<div class="inline-field" data-field="name" data-maxlen="30"
     style="left:80px; top:316px; width:391px; height:55px; position:absolute;">
  <div class="inline-field__frame"></div>
  <span class="inline-field__value">luxurystress@gmail.com</span>
  <input class="inline-field__input" type="text" hidden maxlength="30" inputmode="text">
  <!-- Иконка редактирования: 29×29 @ (421,329) ⇒ offset (341,13) -->
  <button class="inline-field__edit" type="button" aria-label="Редагувати"
          style="left:341px; top:13px;">
    <img src="edit.png" alt="" width="29" height="29" draggable="false">
  </button>
</div>






<section class="cards" aria-labelledby="cards-title">
  <h2 id="cards-title" class="visually-hidden">Банківські карти</h2>

  <!-- Контейнер строк карточек (динамический) -->
  <div class="cards__list" aria-live="polite"></div>

  <!-- Кнопка “Додати карту” -->
  <button class="cards__add" type="button">
    <span class="cards__add-text">Додати карту</span>
    <img class="cards__add-icon" src="plus.png" alt="" width="34" height="34" draggable="false">
  </button>
</section>


<!-- ====== АДРЕСИ (Group 264…266) ====== -->
<section class="addresses" aria-labelledby="addresses-title">
  <h2 id="addresses-title" class="visually-hidden">Адреси</h2>

  <!-- динамический список -->
  <div class="addresses__list" aria-live="polite"></div>

  <!-- кнопка додати -->
  <button class="addresses__add" type="button">
    <span class="addresses__add-text">Додати адресу</span>
    <img class="addresses__add-icon" src="plus.png" alt="" width="34" height="34" draggable="false">
  </button>
</section>

<!-- Адреси доставки -->
<h2 class="h4-green heading--delivery">Адреси доставки</h2>

<!-- Мої карти -->
<h2 class="h4-green heading--cards">Мої карти</h2>



<!-- Блок безопасности -->
<section class="security-widgets" aria-label="Налаштування безпеки">
  <!-- КНОПКА: Змінити пароль -->
  <button class="btn-change-pass" type="button">
    <span class="btn-change-pass__text">Змінити пароль</span>
    <!-- Иконку подставишь свою -->
    <img class="btn-change-pass__icon" src="settings.png" alt="" width="27" height="27" draggable="false">
  </button>

  <!-- МАЛЕНЬКОЕ СОГЛАШЕНИЕ: Двофакторна автентифікація -->
  <div class="twofa" role="group" aria-label="Двофакторна автентифікація">
    <span class="twofa__label">Двофакторна автентифікація</span>

    <!-- Кликабельная маленькая кнопка справа -->
    <button class="twofa__toggle" type="button"
            aria-pressed="false"
            aria-label="Увімкнути двофакторну автентифікацію"></button>
  </div>
</section>





<!-- ===== БАННЕР (Group 463) ===== -->
<section class="promo-banner" aria-labelledby="promo-banner-title">
  <!-- Внешняя рамка (Rectangle 87) -->
  <div class="promo-banner__frame"></div>

  <!-- Заголовок -->
  <h3 id="promo-banner-title" class="promo-banner__title">
    Відкрийте свій магазин та почніть свої перші продажі!
  </h3>

  <!-- CTA-кнопка (Group 256) -->
  <button class="promo-banner__cta" type="button">
    <span class="promo-banner__cta-text">Стати продавцем</span>
    <!-- Иконка-стрелка, ты подставишь свою -->
    <img class="promo-banner__cta-icon" src="plane.png" alt="" width="23" height="22" draggable="false">
  </button>

  <!-- Область с изображением (Group 267) — ты вставляешь своё изображение -->
  <div class="promo-banner__art">
    <img class="promo-banner__img" src="complete.png" alt="">
  </div>
</section>




<div class="order-header">
  <!-- Кликабельная иконка слева -->
  <button class="order-header__icon" type="button" aria-label="Дія">
    <img src="planex.png" alt="" width="30" height="29" draggable="false">
  </button>

  <!-- Заголовок -->
  <h4 class="order-header__title">Редагування профілю</h4>
</div>





<footer class="ftr" role="contentinfo">
  <div class="ftr-bg"></div>

  <!-- Колонки -->
  <h4 class="ftr-h4 ftr-h4--info">Інформація о компанії</h4>
  <ul class="ftr-list ftr-list--info">
    <li><a href="#">Про нас</a></li>
    <li><a href="#">Умови використання сайту</a></li>
    <li><a href="#">Вакансії</a></li>
    <li><a href="#">Контакти</a></li>
    <li><a href="#">Зворотній зв’язок</a></li>
  </ul>

  <h4 class="ftr-h4 ftr-h4--help">Допомога</h4>
  <ul class="ftr-list ftr-list--help">
    <li><a href="#">Часті питання</a></li>
    <li><a href="#">Доставка та оплата</a></li>
    <li><a href="#">Гарантія</a></li>
    <li><a href="#">Повернення</a></li>
  </ul>

  <h4 class="ftr-h4 ftr-h4--sellers">Продавцям</h4>
  <ul class="ftr-list ftr-list--sellers">
    <li><a href="#">Продавати товари</a></li>
    <li><a href="#">Правила торгівлі</a></li>
  </ul>

  <!-- Соцсети -->
  <h4 class="ftr-h4 ftr-h4--social">Ми в соціальних мережах</h4>
  <a class="ftr-soc ftr-soc--ig" href="#" aria-label="Instagram">
    <svg viewBox="0 0 24 24" width="22" height="22" fill="none">
      <rect x="3" y="3" width="18" height="18" rx="5" stroke="#ECECEC" stroke-width="2"/>
      <circle cx="12" cy="12" r="4" stroke="#ECECEC" stroke-width="2"/>
      <circle cx="17" cy="7" r="1" fill="#ECECEC"/>
    </svg>
  </a>
  <a class="ftr-soc ftr-soc--fb" href="#" aria-label="Facebook">
    <svg viewBox="0 0 24 24" width="22" height="22" fill="#ECECEC">
      <path d="M13.5 21v-7h2.3l.4-3H13.5V9.1c0-.9.3-1.5 1.7-1.5H16V5.1c-.3 0-1.3-.1-2.4-.1-2.4 0-4 1.4-4 3.9V11H7v3h2.6v7h3.9z"/>
    </svg>
  </a>
  <a class="ftr-soc ftr-soc--tt" href="#" aria-label="TikTok">
    <svg viewBox="0 0 24 24" width="22" height="22" fill="#ECECEC">
      <path d="M15 3c.6 1.8 2 3.2 3.8 3.7v3.1c-1.5-.1-2.9-.6-4-1.5v5.9a5.6 5.6 0 1 1-5.6-5.6c.5 0 1 .1 1.4.2v3a2.5 2.5 0 1 0 2.2 2.5V3h2.2z"/>
    </svg>
  </a>

  <!-- Декоративная фигура справа -->
  <img class="ftr-mascot" src="maskotfooter.png" alt="Маскот Qonto">

  <!-- Копирайт -->
  <p class="ftr-copy">©2025 Платформа онлайн-торгівлі «Qonto» — використовується на підставі ліцензії правовласника</p>
</footer>



<script>
document.addEventListener('DOMContentLoaded', () => {
  // Инициализируем все поля этой страницы
  document.querySelectorAll('.inline-field').forEach(initInlineField);

  // Делегирование на клик по иконке (если элементы появятся динамически)
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.inline-field__edit');
    if (!btn) return;
    const root = btn.closest('.inline-field');
    if (root) enterEdit(root);
  });

  function initInlineField(root){
    const valueEl = root.querySelector('.inline-field__value');
    const inputEl = root.querySelector('.inline-field__input');
    if (!valueEl || !inputEl) return;

    const MAX_LEN = parseInt(root.dataset.maxlen || '30', 10);
    inputEl.setAttribute('maxlength', String(MAX_LEN));

    // Сеттер значения (без прочерков)
    function setValue(text){
      const t = String(text || '').trim().slice(0, MAX_LEN);
      valueEl.textContent = t;          // если пусто — оставляем пусто
      valueEl.dataset.raw = t;          // храним "истинное" значение
    }
    root.__inline_setValue = setValue;

    // Стартовое значение берём из HTML (то, что уже в span)
    setValue(valueEl.textContent || '');

    // Лимит и обрезание при вводе/вставке
    inputEl.addEventListener('input', () => {
      if (inputEl.value.length > MAX_LEN) {
        inputEl.value = inputEl.value.slice(0, MAX_LEN);
      }
    });

    // Флаг, чтобы blur не отменял сохранение сразу после Enter
    let suppressBlur = false;

    inputEl.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter'){
        e.preventDefault();
        suppressBlur = true;
        exitEdit(root, true);
        setTimeout(()=>{ suppressBlur = false; }, 0);
      } else if (e.key === 'Escape'){
        e.preventDefault();
        exitEdit(root, false);
      }
    });

    inputEl.addEventListener('blur', ()=>{
      if (suppressBlur) return;
      exitEdit(root, false);
    });
  }

  function enterEdit(root){
    const valueEl = root.querySelector('.inline-field__value');
    const inputEl = root.querySelector('.inline-field__input');
    if (!valueEl || !inputEl) return;

    const prev = valueEl.dataset.raw || '';
    inputEl.placeholder = prev;   // прошлое значение серым
    inputEl.value = '';           // вводим "с нуля"
    inputEl.dataset.prev = prev;

    valueEl.style.display = 'none';
    inputEl.hidden = false;
    inputEl.focus();
  }

  function exitEdit(root, save){
    const valueEl = root.querySelector('.inline-field__value');
    const inputEl = root.querySelector('.inline-field__input');
    if (!valueEl || !inputEl) return;

    const prev = inputEl.dataset.prev || '';
    if (save){
      const max = parseInt(root.dataset.maxlen || '30', 10);
      const next = inputEl.value.trim().slice(0, max);
      const finalValue = next.length ? next : prev;

      root.__inline_setValue?.(finalValue);

      // нотификация для бэка (если слушаете на странице)
      window.dispatchEvent(new CustomEvent('inlineField:save', {
        detail: { field: root.dataset.field || '', value: finalValue }
      }));
    } else {
      root.__inline_setValue?.(prev); // откат
    }

    inputEl.hidden = true;
    valueEl.style.display = '';
  }
});

document.addEventListener('DOMContentLoaded', () => {
  const list = document.querySelector('.cards__list');
  const addBtn = document.querySelector('.cards__add');

  const MAX = 3;
  const state = []; // [{number:'16digits'}]

  // Создание строки карточки
  function createRow(idx, value=''){
    const row = document.createElement('div');
    row.className = 'card-row';
    row.dataset.index = String(idx);

    row.innerHTML = `
      <div class="card-row__label"></div>
      <div class="card-row__label-text">Карта ${idx+1}</div>

      <div class="card-row__field"></div>
      <span class="card-row__value"></span>
      <input class="card-row__input" type="text" inputmode="numeric" maxlength="16" hidden>

      <button class="card-row__edit" type="button" aria-label="Редагувати">
        <img src="edit.png" alt="" width="29" height="29" draggable="false">
      </button>
    `;

    const valueEl = row.querySelector('.card-row__value');
    const inputEl = row.querySelector('.card-row__input');
    setMaskedValue(valueEl, value);

    // Клик по “карандашу” — вход в редактирование
    row.querySelector('.card-row__edit').addEventListener('click', () => enterEdit(row));

    // Ввод: только цифры, максимум 16
    inputEl.addEventListener('input', () => {
      inputEl.value = inputEl.value.replace(/\D/g,'').slice(0,16);
      row.classList.remove('is-error');
    });

    // Enter/ESC/blur поведение
    let suppressBlur = false;
    inputEl.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter'){
        e.preventDefault();
        suppressBlur = true;
        exitEdit(row, true);
        setTimeout(()=>{ suppressBlur = false; }, 0);
      } else if (e.key === 'Escape'){
        e.preventDefault();
        exitEdit(row, false);
      }
    });
    inputEl.addEventListener('blur', ()=>{
      if (row.classList.contains('is-error')){ inputEl.focus(); return; }
      if (suppressBlur) return;
      exitEdit(row, false);
    });

    return row;
  }

  // Показ отформатированного значения (по макету без пробелов; хочешь — можно группировать)
  function setMaskedValue(el, digits){
    el.textContent = digits ? digits : '';
    el.dataset.raw = digits || '';
  }

  // Вход в редактирование
  function enterEdit(row){
    const input = row.querySelector('.card-row__input');
    const value = row.querySelector('.card-row__value');
    row.classList.remove('is-error');
    input.hidden = false;
    value.style.display = 'none';

    // ввод "с нуля", прежнее значение в placeholder
    const prev = value.dataset.raw || '';
    input.placeholder = prev;
    input.value = '';
    input.dataset.prev = prev;
    input.focus();
  }

  // Выход из редактирования; save=true — сохранить
  function exitEdit(row, save){
    const input = row.querySelector('.card-row__input');
    const value = row.querySelector('.card-row__value');

    const prev = input.dataset.prev || '';
    if (save){
      const next = (input.value || '').replace(/\D/g,'').slice(0,16);
      if (!isValidLuhn(next)){
        row.classList.add('is-error');
        input.focus();
        return; // остаёмся в редактировании
      }
      setMaskedValue(value, next);
      // записываем в state
      const i = parseInt(row.dataset.index,10);
      state[i] = { number: next };
    } else {
      setMaskedValue(value, prev);
    }

    input.hidden = true;
    value.style.display = '';
  }

  // Лун-проверка
  function isValidLuhn(numStr){
    if (!/^\d{16}$/.test(numStr)) return false;
    let sum = 0;
    for (let i=0;i<16;i++){
      let d = parseInt(numStr[15 - i],10);
      if (i % 2 === 1){ d *= 2; if (d > 9) d -= 9; }
      sum += d;
    }
    return sum % 10 === 0;
  }

  // Добавление новой карточки (создаёт строку и сразу переводит в ввод)
  function addCard(){
    if (state.length >= MAX) return;
    const idx = state.length;
    state.push({ number:'' });

    const row = createRow(idx, '');
    list.appendChild(row);
    refreshIndices();

    // сразу в режим ввода
    enterEdit(row);

    // если достигли лимита — дизейблим кнопку
    if (state.length >= MAX) addBtn.disabled = true;
  }

  // Перенумерация/позиции/лейблы после любых изменений
  function refreshIndices(){
    const rows = Array.from(list.querySelectorAll('.card-row'));
    rows.forEach((row, i)=>{
      row.dataset.index = String(i);
      row.style.top = (i*65) + 'px'; // 55 высота + 10/межстрочный = 65 (в макете 632-567=65)
      row.querySelector('.card-row__label-text').textContent = `Карта ${i+1}`;
    });
    // Подвинем кнопку "Добавить" ниже последней строки
    const nextTop = rows.length ? (rows.length*65 + 20) : 150;
    document.querySelector('.cards__add').style.top = nextTop + 'px';
  }

  // Инициализация: изначально карточек нет
  addBtn.addEventListener('click', addCard);
});

document.addEventListener('DOMContentLoaded', () => {
  const list  = document.querySelector('.addresses__list');
  const addBtn= document.querySelector('.addresses__add');

  const MAX = 2;
  const state = []; // [{label:'Дім', address:'м. Харків…'}]

  function createRow(idx, label='', address=''){
    const row = document.createElement('div');
    row.className = 'addr-row';
    row.dataset.index = String(idx);

    // параметры по макету для каждого ряда
    const isFirst = idx === 0;
    const labWCls = isFirst ? 'addr-row__label--w77' : 'addr-row__label--w93';
    const fldWCls = isFirst ? 'addr-row__field--r1'  : 'addr-row__field--r2';
    const labInCls= isFirst ? 'addr-row__input-label--w77' : 'addr-row__input-label--w93';
    const inpInCls= isFirst ? 'addr-row__input--r1' : 'addr-row__input--r2';

    row.innerHTML = `
      <div class="addr-row__label ${labWCls}"></div>
      <div class="addr-row__label-text">${label || 'Дім'}</div>
      <div class="addr-row__field ${fldWCls}"></div>
      <span class="addr-row__value">${address || ''}</span>

      <input class="addr-row__input-label ${labInCls}" type="text" maxlength="20" hidden>
      <input class="addr-row__input ${inpInCls}" type="text" maxlength="120" hidden>

      <button class="addr-row__edit" type="button" aria-label="Редагувати">
        <img src="edit.png" alt="" width="29" height="29" draggable="false">
      </button>
    `;

    // кэш
    const labelText = row.querySelector('.addr-row__label-text');
    const valueEl   = row.querySelector('.addr-row__value');
    const inputLab  = row.querySelector('.addr-row__input-label');
    const inputAddr = row.querySelector('.addr-row__input');

    // клики по ярлыку / адресу — редактировать соответствующее
    labelText.addEventListener('click', ()=> enterEdit(row, 'label'));
    valueEl  .addEventListener('click', ()=> enterEdit(row, 'address'));

    // карандаш — редактировать оба
    row.querySelector('.addr-row__edit').addEventListener('click', ()=> enterEdit(row, 'both'));

    // валидация простая: не пусто
    function handleKey(target, e){
      if (e.key === 'Enter'){
        e.preventDefault();
        saveEdit(row);
      } else if (e.key === 'Escape'){
        e.preventDefault();
        cancelEdit(row);
      }
    }
    inputLab .addEventListener('keydown', e=>handleKey(inputLab, e));
    inputAddr.addEventListener('keydown', e=>handleKey(inputAddr,e));

    inputLab .addEventListener('blur', ()=>{ if (!row.__editingSingle || row.__editingSingle==='label') cancelEdit(row); });
    inputAddr.addEventListener('blur', ()=>{ if (!row.__editingSingle || row.__editingSingle==='address') cancelEdit(row); });

    return row;
  }

  function enterEdit(row, which /* 'label'|'address'|'both' */){
    const labelText = row.querySelector('.addr-row__label-text');
    const valueEl   = row.querySelector('.addr-row__value');
    const inputLab  = row.querySelector('.addr-row__input-label');
    const inputAddr = row.querySelector('.addr-row__input');

    row.__editingSingle = (which==='label' || which==='address') ? which : null;

    // подготовка значений
    inputLab.value = '';  inputLab.placeholder = labelText.textContent.trim();
    inputAddr.value= '';  inputAddr.placeholder= valueEl.textContent.trim();

    // показать нужные инпуты
    if (which==='label' || which==='both'){
      inputLab.hidden = false;
      labelText.style.visibility = 'hidden';
      setTimeout(()=> inputLab.focus(), 0);
    }
    if (which==='address' || which==='both'){
      inputAddr.hidden = false;
      valueEl.style.visibility = 'hidden';
      if (which==='address') setTimeout(()=> inputAddr.focus(), 0);
    }
  }

  function saveEdit(row){
    const labelText = row.querySelector('.addr-row__label-text');
    const valueEl   = row.querySelector('.addr-row__value');
    const inputLab  = row.querySelector('.addr-row__input-label');
    const inputAddr = row.querySelector('.addr-row__input');

    const newLabel = (inputLab.value.trim()  || inputLab.placeholder || 'Дім').slice(0,20);
    const newAddr  = (inputAddr.value.trim() || inputAddr.placeholder || '').slice(0,120);

    // обязателен хотя бы адрес
    if (!newAddr){
      // просто вернёмся без сохранения адреса, но ярлык можем сохранить
      if (row.__editingSingle === 'label' && newLabel){
        labelText.textContent = newLabel;
      }
      return cancelEdit(row);
    }

    labelText.textContent = newLabel;
    valueEl.textContent   = newAddr;

    // сохранить в state
    const i = parseInt(row.dataset.index,10);
    state[i] = { label:newLabel, address:newAddr };

    finishEdit(row);
  }

  function cancelEdit(row){
    finishEdit(row);
  }
  function finishEdit(row){
    const labelText = row.querySelector('.addr-row__label-text');
    const valueEl   = row.querySelector('.addr-row__value');
    const inputLab  = row.querySelector('.addr-row__input-label');
    const inputAddr = row.querySelector('.addr-row__input');

    inputLab.hidden = true; inputAddr.hidden = true;
    labelText.style.visibility = ''; valueEl.style.visibility = '';
    row.__editingSingle = null;
  }

  function addAddress(){
    if (state.length >= MAX) return;
    const idx = state.length;
    state.push({ label:'Дім', address:'' }); // базовые значения

    const row = createRow(idx, state[idx].label, state[idx].address);
    list.appendChild(row);
    refreshIndices();

    // сразу в режим ввода адреса (и лейбла тоже удобно)
    enterEdit(row, 'both');
    if (state.length >= MAX) addBtn.disabled = true;
  }

  function refreshIndices(){
    const rows = Array.from(list.querySelectorAll('.addr-row'));
    rows.forEach((row, i)=>{
      row.dataset.index = String(i);
      row.style.top = (i*65) + 'px';
      // подгоняем классы ширин/отступов под конкретный индекс
      const isFirst = i === 0;
      const labelBox = row.querySelector('.addr-row__label');
      labelBox.classList.toggle('addr-row__label--w77', isFirst);
      labelBox.classList.toggle('addr-row__label--w93', !isFirst);

      const fieldBox = row.querySelector('.addr-row__field');
      fieldBox.classList.toggle('addr-row__field--r1', isFirst);
      fieldBox.classList.toggle('addr-row__field--r2', !isFirst);

      const inLab = row.querySelector('.addr-row__input-label');
      inLab.classList.toggle('addr-row__input-label--w77', isFirst);
      inLab.classList.toggle('addr-row__input-label--w93', !isFirst);

      const inAddr = row.querySelector('.addr-row__input');
      inAddr.classList.toggle('addr-row__input--r1', isFirst);
      inAddr.classList.toggle('addr-row__input--r2', !isFirst);
    });

    // смещаем кнопку добавления в фиксированное место (по макету 150px от верха блока)
    document.querySelector('.addresses__add').style.top = (rows.length ? 150 : 150) + 'px';
  }

  // старт: пусто
  addBtn.addEventListener('click', addAddress);
});

document.addEventListener('DOMContentLoaded', () => {
  const toggle = document.querySelector('.twofa__toggle');
  if (!toggle) return;

  toggle.addEventListener('click', () => {
    const on = toggle.classList.toggle('is-on');
    toggle.setAttribute('aria-pressed', on ? 'true' : 'false');
  });

  // Пример действия главной кнопки — откроешь своё окно смены пароля
  document.querySelector('.btn-change-pass')?.addEventListener('click', () => {
    // TODO: здесь подключи свою модалку "сменить пароль"
    // openChangePasswordModal();
    console.log('Натиснуто «Змінити пароль»');
  });
});
</script>


</body>
</html>